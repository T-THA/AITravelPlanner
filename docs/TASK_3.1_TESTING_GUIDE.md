# Task 3.1 需求输入界面 - 测试验收指南

## 📋 测试前准备

### 1. 环境确认
- ✅ 确保开发服务器正在运行: `npm run dev`
- ✅ 浏览器访问: http://localhost:5174
- ✅ 确保已登录账号

### 2. API 配置确认
确保 `.env` 文件包含以下配置：
```
VITE_IFLYTEK_APP_ID=你的讯飞APPID
VITE_IFLYTEK_API_KEY=你的讯飞APIKey
VITE_IFLYTEK_API_SECRET=你的讯飞APISecret
VITE_ALIYUN_API_KEY=你的阿里云API Key
VITE_ALIYUN_BASE_URL=你的百炼服务地址
VITE_ALIYUN_MODEL_NAME=qwen-turbo
```

---

## 🎯 核心功能测试

### 测试 1: 单页表单布局
**目标**: 验证单页表单所有字段可见且布局合理

**步骤**:
1. 点击顶部导航 "创建行程"
2. 观察页面布局

**预期结果**:
- ✅ 页面顶部显示蓝色背景的 "🎙️ 语音输入 (快捷方式)" 卡片
- ✅ 下方依次显示 3 个表单卡片：
  - 📍 基本信息（目的地、出发日期）
  - 💰 预算与人员（预算、人数、人员类型）
  - ❤️ 旅行偏好（偏好、住宿、节奏、特殊需求）
- ✅ 所有字段可见，无需翻页
- ✅ 页面底部有 "提交" 按钮

---

### 测试 2: 语音输入 - 基础场景
**目标**: 验证语音识别和智能解析基本功能

#### 场景 2.1: 完整描述
**测试语音**: "我想下个月去北京玩5天，预算1万块，喜欢历史文化和美食"

**步骤**:
1. 点击 "点击录音" 按钮
2. 弹出语音输入模态框
3. 点击 "开始录音" 按钮
4. 说出测试语音（清晰、正常语速）
5. 观察实时识别区域是否显示识别文字
6. 点击 "停止录音并识别"
7. 等待解析完成

**预期结果**:
- ✅ 录音时模态框内实时显示识别文字（不应该溢出边界）
- ✅ 识别文字完整显示，不会变成句号
- ✅ 解析成功后自动填充表单：
  - 目的地: `["北京"]`
  - 出发日期: 下个月1号
  - 返程日期: 下个月5号（共5天）
  - 预算: `10000`
  - 同行人数: `1`
  - 旅行偏好: `["历史", "文化", "美食"]`
- ✅ 显示成功提示："解析成功!"
- ✅ 模态框自动关闭

#### 场景 2.2: 带家人出行
**测试语音**: "我和老婆想去杭州，看西湖，逛逛博物馆"

**预期结果**:
- ✅ 同行人数: `2` （识别 "我和老婆"）
- ✅ 目的地: `["杭州"]`
- ✅ 旅行偏好: `["自然", "文化"]` （识别 "西湖"、"博物馆"）

#### 场景 2.3: 带孩子旅行
**测试语音**: "带着孩子去成都吃火锅，大概玩3天"

**预期结果**:
- ✅ 同行人数: `3` （识别 "带着孩子" -> 默认3人）
- ✅ 目的地: `["成都"]`
- ✅ 天数: 3天
- ✅ 旅行偏好: `["美食", "亲子"]` （识别 "火锅"、"孩子"）

#### 场景 2.4: 明确日期
**测试语音**: "3月15号去上海，两个人"

**预期结果**:
- ✅ 目的地: `["上海"]`
- ✅ 出发日期: `2026-03-15` （明年3月15日）
- ✅ 同行人数: `2`

---

### 测试 3: 实时识别文字显示
**目标**: 验证录音时实时文字显示功能

**步骤**:
1. 点击 "点击录音" -> "开始录音"
2. 慢速说话："我 -- 想 -- 去 -- 杭州 -- 玩"
3. 观察实时识别区域

**预期结果**:
- ✅ 说话时立即显示 "实时识别:" 文字框
- ✅ 文字逐步更新：`"我"` -> `"我想"` -> `"我想去"` -> `"我想去杭州"` -> `"我想去杭州玩"`
- ✅ 文字框宽度不会超出模态框边界
- ✅ 完整保留所有识别内容，**不会只显示句号**
- ✅ 文字可以正常换行

---

### 测试 4: 手动表单填写
**目标**: 验证手动填写表单的完整性和验证规则

**步骤**:
1. 手动填写所有字段：
   - 目的地: `["北京", "西安"]`
   - 出发日期: 明天
   - 返程日期: 后天
   - 预算: `5000`
   - 同行人数: `2`
   - 人员构成: `["成人"]`
   - 旅行偏好: `["历史", "文化"]`
   - 住宿偏好: `舒适型`
   - 行程节奏: `适中`
2. 点击 "提交"

**预期结果**:
- ✅ 所有必填字段验证通过
- ✅ 显示加载状态
- ✅ 提交成功后显示："行程需求已保存，正在生成行程..."
- ✅ 跳转到 `/itineraries` 页面

#### 测试 4.1: 必填字段验证
**步骤**:
1. 不填写任何字段，直接点击 "提交"

**预期结果**:
- ❌ 显示验证错误：
  - "请输入目的地!"
  - "请选择出行日期!"
  - "请输入预算!"
  - 等等

---

### 测试 5: 草稿自动保存
**目标**: 验证表单草稿自动保存和恢复功能

**步骤**:
1. 填写部分表单字段（如目的地、预算）
2. 刷新页面（F5）
3. 观察表单内容

**预期结果**:
- ✅ 刷新后表单自动恢复之前填写的内容
- ✅ 目的地、预算、日期等所有字段都被恢复

---

## 🐛 边界情况测试

### 测试 6: 语音识别错误处理

#### 场景 6.1: 麦克风权限拒绝
**步骤**:
1. 浏览器拒绝麦克风权限
2. 点击 "开始录音"

**预期结果**:
- ❌ 显示错误提示："录音失败: ..."
- ✅ 模态框保持打开，可以重试

#### 场景 6.2: 识别内容为空
**步骤**:
1. 点击 "开始录音"
2. 不说话，立即点击 "停止录音并识别"

**预期结果**:
- ⚠️ 显示警告："请先录音"
- ✅ 不会调用 LLM 解析

#### 场景 6.3: 识别内容无效
**测试语音**: "啊啊啊啊啊啊啊"

**预期结果**:
- ✅ 可以正常识别文字
- ⚠️ 解析后部分字段可能为 null（目的地等）
- ✅ 成功填充到表单（null 字段保持空白）

---

### 测试 7: 表单提交错误处理

#### 场景 7.1: 未登录用户
**步骤**:
1. 退出登录
2. 尝试访问创建行程页面

**预期结果**:
- ✅ 自动重定向到登录页面

#### 场景 7.2: 网络错误
**步骤**:
1. 断开网络
2. 填写表单并提交

**预期结果**:
- ❌ 显示错误提示："保存失败，请检查网络连接"
- ✅ 表单内容保留（可重新提交）

---

## 🎨 UI/UX 测试

### 测试 8: 响应式布局
**步骤**:
1. 调整浏览器窗口大小（从宽屏到窄屏）
2. 观察表单布局

**预期结果**:
- ✅ 表单最大宽度 1000px，居中显示
- ✅ 窄屏时各字段自动换行
- ✅ 模态框在小屏幕上自适应

### 测试 9: 交互体验
**观察点**:
- ✅ 按钮 hover 效果正常
- ✅ 表单验证错误显示在字段下方
- ✅ 日期选择器禁用过去日期
- ✅ 多选框（偏好、人员类型）可以选择多个
- ✅ 单选框（住宿、节奏）只能选一个

---

## ✅ 验收标准

### 核心功能（必须全部通过）
- [ ] 单页表单所有字段可见
- [ ] 语音录音正常启动和停止
- [ ] 实时文字在模态框内正确显示（不溢出、内容完整）
- [ ] 语音解析成功填充表单
- [ ] 人数识别准确（"我和老婆" -> 2人）
- [ ] 偏好识别准确（"美食"、"历史" 等）
- [ ] 日期解析准确（"下个月"、"3月15号"）
- [ ] 手动填写表单可以正常提交
- [ ] 草稿自动保存和恢复

### 用户体验（建议通过）
- [ ] 实时文字显示流畅
- [ ] 模态框交互友好
- [ ] 错误提示清晰明确
- [ ] 响应式布局合理

---

## 📝 测试记录

### 测试环境
- 浏览器: _________________
- 操作系统: _________________
- 测试时间: _________________

### 测试结果
| 测试项 | 状态 | 备注 |
|--------|------|------|
| 测试 1: 单页表单布局 | ⬜ |  |
| 测试 2.1: 完整描述 | ⬜ |  |
| 测试 2.2: 带家人出行 | ⬜ |  |
| 测试 2.3: 带孩子旅行 | ⬜ |  |
| 测试 2.4: 明确日期 | ⬜ |  |
| 测试 3: 实时识别显示 | ⬜ |  |
| 测试 4: 手动表单填写 | ⬜ |  |
| 测试 5: 草稿自动保存 | ⬜ |  |
| 测试 6: 错误处理 | ⬜ |  |

### 发现的问题
1. _______________________________________________
2. _______________________________________________
3. _______________________________________________

---

## 🚀 下一步

测试通过后，进入 **Task 3.2: 行程生成引擎开发**
