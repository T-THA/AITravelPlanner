# Supabase é…ç½®å®ŒæˆæŠ¥å‘Š

## å®Œæˆæ—¶é—´
2025å¹´11æœˆ1æ—¥

## é…ç½®çŠ¶æ€

### âœ… å·²å®Œæˆé¡¹ç›®

1. **Supabase é¡¹ç›®åˆ›å»º**
   - âœ… æ³¨å†Œ Supabase è´¦å·
   - âœ… åˆ›å»ºé¡¹ç›®: `ai-travel-planner`
   - âœ… é€‰æ‹©åŒºåŸŸ: Northeast Asia (Tokyo)

2. **API å‡­è¯é…ç½®**
   - âœ… è·å– Project URL
   - âœ… è·å– anon (public) key
   - âœ… é…ç½®åˆ° `.env` æ–‡ä»¶

3. **ç¯å¢ƒå˜é‡**
   ```
   VITE_SUPABASE_URL=https://opdmfigumtliblfvbhhi.supabase.co
   VITE_SUPABASE_ANON_KEY=eyJhbGci...ï¼ˆå·²é…ç½®ï¼‰
   ```

4. **ä»£ç é›†æˆ**
   - âœ… Supabase å®¢æˆ·ç«¯åˆå§‹åŒ– (`src/services/supabase.ts`)
   - âœ… è®¤è¯æœåŠ¡å°è£… (`src/services/auth.ts`)
   - âœ… çŠ¶æ€ç®¡ç†é›†æˆ (`src/stores/authStore.ts`)

5. **æµ‹è¯•å·¥å…·**
   - âœ… åˆ›å»ºæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ (`database/init.sql`)
   - âœ… åˆ›å»º Supabase è¿æ¥æµ‹è¯•è„šæœ¬ (`scripts/test-supabase.ts`)
   - âœ… æ·»åŠ æµ‹è¯•å‘½ä»¤: `npm run test:supabase`

## â³ ä¸‹ä¸€æ­¥æ“ä½œ

### éœ€è¦åœ¨ Supabase Dashboard æ‰§è¡Œ

ç”±äºæ•°æ®åº“è¡¨å°šæœªåˆ›å»ºï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. **è®¿é—® Supabase Dashboard**
   - URL: https://supabase.com/dashboard
   - é€‰æ‹©é¡¹ç›®: `ai-travel-planner`

2. **è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬**
   ```
   æ­¥éª¤ï¼š
   a. ç‚¹å‡»å·¦ä¾§èœå• "SQL Editor"
   b. ç‚¹å‡» "New query"
   c. å¤åˆ¶ `database/init.sql` æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹
   d. ç²˜è´´åˆ° SQL ç¼–è¾‘å™¨
   e. ç‚¹å‡» "Run" æ‰§è¡Œ
   f. ç¡®è®¤æ‰€æœ‰è¯­å¥æ‰§è¡ŒæˆåŠŸï¼ˆæ˜¾ç¤ºç»¿è‰²å‹¾å·ï¼‰
   ```

3. **éªŒè¯æ•°æ®åº“è¡¨**
   ```
   æ­¥éª¤ï¼š
   a. ç‚¹å‡»å·¦ä¾§èœå• "Table Editor"
   b. ç¡®è®¤çœ‹åˆ°ä»¥ä¸‹è¡¨ï¼š
      âœ“ user_profiles
      âœ“ trips
      âœ“ itinerary_items
      âœ“ expenses
   ```

4. **é…ç½®è®¤è¯è®¾ç½®**
   ```
   æ­¥éª¤ï¼š
   a. ç‚¹å‡»å·¦ä¾§èœå• "Authentication" â†’ "Providers"
   b. ç¡®è®¤ "Email" å·²å¯ç”¨
   c. ï¼ˆå¯é€‰ï¼‰è‡ªå®šä¹‰é‚®ä»¶æ¨¡æ¿
   ```

5. **å†æ¬¡è¿è¡Œæµ‹è¯•**
   ```bash
   npm run test:supabase
   ```

## æ•°æ®åº“æ¶æ„

### è¡¨ç»“æ„æ¦‚è§ˆ

```
auth.users (Supabase å†…ç½®)
    â†“
user_profiles (ç”¨æˆ·æ‰©å±•ä¿¡æ¯)
    â†“
trips (æ—…è¡Œè®¡åˆ’)
    â”œâ†’ itinerary_items (è¡Œç¨‹é¡¹)
    â””â†’ expenses (è´¹ç”¨è®°å½•)
```

### åˆ›å»ºçš„è¡¨

| è¡¨å | è¯´æ˜ | å­—æ®µæ•° |
|------|------|--------|
| user_profiles | ç”¨æˆ·æ‰©å±•ä¿¡æ¯ | 6 |
| trips | æ—…è¡Œè®¡åˆ’ä¸»è¡¨ | 16 |
| itinerary_items | è¡Œç¨‹é¡¹è¯¦æƒ… | 12 |
| expenses | è´¹ç”¨è®°å½• | 9 |

### RLS (è¡Œçº§å®‰å…¨) ç­–ç•¥

æ‰€æœ‰è¡¨éƒ½å·²å¯ç”¨ RLSï¼Œç¡®ä¿ï¼š
- âœ… ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- âœ… ç”¨æˆ·ä¸èƒ½æŸ¥çœ‹å…¶ä»–ç”¨æˆ·çš„æ•°æ®
- âœ… æ•°æ®éš”ç¦»å’Œå®‰å…¨æ€§

## æµ‹è¯•éªŒæ”¶æ ‡å‡†

### âœ… å·²é€šè¿‡
- [x] Supabase é¡¹ç›®åˆ›å»ºæˆåŠŸ
- [x] API å‡­è¯é…ç½®æ­£ç¡®
- [x] ç¯å¢ƒå˜é‡åŠ è½½æ­£å¸¸
- [x] Supabase å®¢æˆ·ç«¯è¿æ¥æ­£å¸¸
- [x] æµ‹è¯•è„šæœ¬è¿è¡ŒæˆåŠŸ

### â³ å¾…éªŒè¯ï¼ˆæ•°æ®åº“åˆå§‹åŒ–åï¼‰
- [ ] æ‰€æœ‰æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ
- [ ] RLS ç­–ç•¥é…ç½®æ­£ç¡®
- [ ] ç´¢å¼•åˆ›å»ºæˆåŠŸ
- [ ] è§¦å‘å™¨å·¥ä½œæ­£å¸¸
- [ ] ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æ­£å¸¸
- [ ] ç”¨æˆ·ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] é‚®ç®±éªŒè¯é‚®ä»¶å‘é€æ­£å¸¸

## åŠŸèƒ½æµ‹è¯•è®¡åˆ’

æ•°æ®åº“åˆå§‹åŒ–å®Œæˆåï¼Œå°†æµ‹è¯•ï¼š

### 1. ç”¨æˆ·æ³¨å†Œæµ‹è¯•
```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬ï¼ˆåŒ…å«æ³¨å†Œæµ‹è¯•ï¼‰
npm run test:supabase
```

### 2. ç”¨æˆ·ç™»å½•æµ‹è¯•
- åœ¨æµè§ˆå™¨æ‰“å¼€: http://localhost:5173/register
- æ³¨å†Œæ–°ç”¨æˆ·
- æ£€æŸ¥é‚®ç®±éªŒè¯é‚®ä»¶
- ä½¿ç”¨æ³¨å†Œçš„è´¦å·ç™»å½•

### 3. æ•°æ®æ“ä½œæµ‹è¯•
- åˆ›å»ºæ—…è¡Œè®¡åˆ’
- æ·»åŠ è¡Œç¨‹é¡¹
- è®°å½•è´¹ç”¨

## ç›¸å…³æ–‡ä»¶

### æ–°åˆ›å»ºçš„æ–‡ä»¶
- `database/init.sql` - æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
- `frontend/scripts/test-supabase.ts` - Supabase è¿æ¥æµ‹è¯•è„šæœ¬

### é…ç½®æ–‡ä»¶
- `frontend/.env` - ç¯å¢ƒå˜é‡é…ç½®
- `frontend/src/services/supabase.ts` - Supabase å®¢æˆ·ç«¯
- `frontend/src/services/auth.ts` - è®¤è¯æœåŠ¡

### ç›¸å…³æ–‡æ¡£
- `docs/SUPABASE_SETUP.md` - Supabase é…ç½®æŒ‡å—
- `docs/DATABASE_DESIGN.md` - æ•°æ®åº“è®¾è®¡æ–‡æ¡£

## å¸¸è§é—®é¢˜

### Q1: æµ‹è¯•è„šæœ¬æŠ¥å‘Šè¡¨æœªåˆ›å»º
**A:** è¿™æ˜¯æ­£å¸¸çš„ï¼Œéœ€è¦åœ¨ Supabase Dashboard ä¸­è¿è¡Œ `database/init.sql` è„šæœ¬ã€‚

### Q2: å¦‚ä½•æŸ¥çœ‹ Supabase æ—¥å¿—
**A:** åœ¨ Supabase Dashboard â†’ Logs â†’ Database ä¸­æŸ¥çœ‹ã€‚

### Q3: å¦‚ä½•é‡ç½®æ•°æ®åº“
**A:** åœ¨ SQL Editor ä¸­å…ˆåˆ é™¤æ‰€æœ‰è¡¨ï¼Œç„¶åé‡æ–°è¿è¡Œ `init.sql`ã€‚

## ä¸‹ä¸€é˜¶æ®µä»»åŠ¡

å®Œæˆæ•°æ®åº“åˆå§‹åŒ–åï¼Œç»§ç»­é˜¶æ®µä¸€çš„å…¶ä»–ä»»åŠ¡ï¼š

1. **ç§‘å¤§è®¯é£è¯­éŸ³è¯†åˆ« API è°ƒè¯•** (1å¤©)
   - æ³¨å†Œç§‘å¤§è®¯é£è´¦å·
   - åˆ›å»ºåº”ç”¨å¹¶è·å– API Keys
   - å®ç°è¯­éŸ³å½•åˆ¶åŠŸèƒ½
   - é›†æˆè¯­éŸ³è¯†åˆ« API

2. **é«˜å¾·åœ°å›¾ API è°ƒè¯•** (1å¤©)
   - æ³¨å†Œé«˜å¾·å¼€æ”¾å¹³å°è´¦å·
   - åˆ›å»ºåº”ç”¨å¹¶è·å– API Key
   - é›†æˆåœ°å›¾æ˜¾ç¤ºåŠŸèƒ½

3. **é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å° API è°ƒè¯•** (1å¤©)
   - æ³¨å†Œé˜¿é‡Œäº‘è´¦å·
   - å¼€é€šç™¾ç‚¼æœåŠ¡
   - æµ‹è¯•å¯¹è¯åŠŸèƒ½

## æ€»ç»“

Supabase é…ç½®çš„ä»£ç éƒ¨åˆ†å·²ç»å…¨éƒ¨å®Œæˆï¼åªéœ€è¦åœ¨ Supabase Dashboard ä¸­è¿è¡Œä¸€æ¬¡ SQL è„šæœ¬ï¼Œå°±å¯ä»¥å®Œæˆæ•´ä¸ªæ•°æ®åº“çš„åˆå§‹åŒ–ã€‚

**å½“å‰çŠ¶æ€**: ğŸŸ¡ ç­‰å¾…æ•°æ®åº“åˆå§‹åŒ–  
**é¢„è®¡å®Œæˆæ—¶é—´**: 5-10 åˆ†é’Ÿï¼ˆè¿è¡Œ SQL è„šæœ¬ï¼‰  
**ä¸‹ä¸€æ­¥**: åœ¨ Supabase Dashboard æ‰§è¡Œ `database/init.sql`

---

**ç”Ÿæˆæ—¶é—´**: 2025å¹´11æœˆ1æ—¥  
**é˜¶æ®µ**: é˜¶æ®µä¸€ - ä»»åŠ¡ 1.2 è¿›è¡Œä¸­ â³
