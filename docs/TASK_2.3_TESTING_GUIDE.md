# Task 2.3 测试指南 - 个人中心页面

## 测试环境
- 开发服务器: http://localhost:5174/
- 测试账号: 使用您已注册的邮箱账号

---

## 前置条件

### ⚠️ 重要: Supabase Storage 配置

在测试头像上传功能前,需要先配置 Supabase Storage:

1. 登录 [Supabase Dashboard](https://supabase.com/dashboard)
2. 选择您的项目
3. 参考 `docs/SUPABASE_STORAGE_SETUP.md` 完成以下配置:
   - ✅ 创建 `avatars` bucket
   - ✅ 设置为 Public
   - ✅ 配置上传/删除/读取策略

**如果未配置 Storage,头像上传功能将无法使用!**

---

## 测试流程

### 1. 登录系统
1. 访问 http://localhost:5174/login
2. 使用已注册的邮箱和密码登录
3. 成功后跳转到 Dashboard

### 2. 访问个人中心
1. 点击左侧菜单 **个人资料**
2. 或点击右上角用户头像 → **个人中心**
3. 页面应显示:
   - ✅ 左侧: 基本信息卡片
   - ✅ 右侧: 旅行偏好卡片

---

## 功能测试清单

### 功能 1: 编辑个人资料

#### 测试步骤:
1. 点击 **编辑资料** 按钮
2. Modal 弹出,显示当前用户信息
3. 修改昵称 (例如: "旅行达人")
4. 点击 **选择图片** 上传头像:
   - ✅ 选择一张 JPG/PNG 图片 (< 2MB)
   - ✅ 头像预览应立即更新
5. 点击 **保存** 按钮
6. 等待上传和保存完成

#### 预期结果:
- ✅ 提示 "资料更新成功!"
- ✅ Modal 自动关闭
- ✅ 页面显示更新后的昵称和头像
- ✅ 刷新页面,数据保持不变

#### 可能的错误:
- ❌ "头像上传失败" → 检查 Supabase Storage 配置
- ❌ "更新失败: permission denied" → 检查 RLS 策略
- ❌ "图片大小不能超过 2MB" → 选择更小的图片

---

### 功能 2: 设置旅行偏好

#### 测试步骤:
1. 点击右侧卡片的 **设置偏好** 按钮
2. Modal 弹出,显示偏好设置表单
3. 填写偏好信息:
   - **喜欢的目的地**: 点击 + 添加,例如 "日本"、"法国"
   - **旅行风格**: 多选,例如 勾选 "文化探索"、"美食之旅"
   - **预算偏好**: 单选,例如 选择 "舒适型"
   - **交通偏好**: 多选,例如 勾选 "飞机"、"高铁"
   - **住宿偏好**: 多选,例如 勾选 "星级酒店"、"民宿/客栈"
4. 点击 **保存** 按钮

#### 预期结果:
- ✅ 提示 "偏好设置已保存!"
- ✅ Modal 自动关闭
- ✅ 右侧卡片显示已设置的偏好 (带彩色标签)
- ✅ 刷新页面,偏好数据保持不变

#### 标签颜色:
- 目的地: 蓝色
- 旅行风格: 绿色
- 预算偏好: 橙色
- 交通偏好: 紫色
- 住宿偏好: 青色

---

### 功能 3: 修改密码

#### 测试步骤:
1. 点击 **修改密码** 按钮
2. Modal 弹出,显示密码修改表单
3. 输入新密码 (例如: "NewPass123!")
   - ✅ 密码强度条应实时更新
   - ✅ 强度显示: 弱 / 中等 / 强
4. 输入确认密码 (与新密码相同)
5. 点击 **确认修改** 按钮

#### 预期结果:
- ✅ 提示 "密码修改成功!请使用新密码重新登录"
- ✅ 1.5秒后自动跳转到登录页
- ✅ 使用新密码可以成功登录
- ✅ 使用旧密码无法登录

#### 密码要求:
- 长度至少 8 个字符
- 必须包含字母和数字
- 建议包含大小写字母和特殊字符

#### 可能的错误:
- ❌ "两次输入的密码不一致" → 检查确认密码
- ❌ "密码长度至少为 8 个字符" → 密码太短
- ❌ "密码必须包含字母和数字" → 密码过于简单

---

## 数据持久化测试

### 测试步骤:
1. 完成上述所有设置 (昵称、头像、偏好)
2. 刷新浏览器页面 (F5)
3. 清除浏览器缓存后再次访问
4. 退出登录,重新登录

### 预期结果:
- ✅ 所有数据都应保持不变
- ✅ 头像正常显示
- ✅ 昵称正确显示
- ✅ 偏好设置完整保存

---

## 错误处理测试

### 测试 1: 上传超大图片
1. 选择一张 > 2MB 的图片
2. 预期: 提示 "图片大小不能超过 2MB!"

### 测试 2: 上传非图片文件
1. 选择一个 PDF 或其他文件
2. 预期: 提示 "只能上传图片文件!"

### 测试 3: 昵称验证
1. 输入空昵称 → "请输入昵称"
2. 输入 1 个字符 → "昵称长度为 2-20 个字符"
3. 输入特殊字符 (如 @#$) → "昵称只能包含中英文、数字、下划线和横线"

### 测试 4: 密码验证
1. 新密码 < 8 位 → "密码长度至少为 8 个字符"
2. 纯数字密码 → "密码必须包含字母和数字"
3. 确认密码不一致 → "两次输入的密码不一致"

---

## 界面测试

### 响应式设计
1. 在桌面浏览器测试 (1920x1080)
   - ✅ 两列布局 (基本信息 | 旅行偏好)
2. 缩小浏览器窗口或使用手机模式
   - ✅ 单列布局,卡片堆叠显示
3. 测试 Modal 在不同屏幕的显示

### 视觉检查
- ✅ 头像圆形显示
- ✅ 标签颜色正确
- ✅ 按钮样式统一
- ✅ 间距合理
- ✅ 加载动画流畅

---

## 性能测试

### 加载速度
1. 首次加载个人中心页面
   - ✅ 应在 1 秒内显示加载动画
   - ✅ 数据在 2 秒内加载完成

### 头像上传
1. 上传 1MB 图片
   - ✅ 应在 3 秒内完成
   - ✅ 显示上传进度

---

## 集成测试

### 测试场景 1: 新用户首次设置
1. 注册新账号并登录
2. 访问个人中心
3. 应自动创建空的 profile
4. 完成资料编辑和偏好设置
5. 所有数据正常保存

### 测试场景 2: 多次修改
1. 修改昵称 3 次
2. 更换头像 2 次
3. 修改偏好设置 2 次
4. 每次修改都应成功
5. 旧头像应被删除 (检查 Storage)

### 测试场景 3: 并发操作
1. 快速连续点击 "保存" 按钮
2. 预期: 第一次保存成功,后续请求被阻止
3. 不应出现重复保存

---

## 浏览器兼容性

测试以下浏览器:
- [ ] Chrome (推荐)
- [ ] Edge
- [ ] Firefox
- [ ] Safari (如可用)

---

## 已知问题

### Issue 1: Supabase Storage 未配置
**现象**: 头像上传失败,提示 "上传失败"
**解决**: 按照 `docs/SUPABASE_STORAGE_SETUP.md` 配置 Storage

### Issue 2: Profile 不存在
**现象**: 页面加载失败或显示空数据
**解决**: 系统会自动创建空 profile,刷新页面即可

---

## 测试报告模板

```markdown
## Task 2.3 测试报告

### 测试环境
- 浏览器: Chrome 120
- 操作系统: Windows 11
- 测试日期: 2025-XX-XX

### 测试结果

#### 编辑个人资料
- [ ] 修改昵称: ✅ 通过 / ❌ 失败
- [ ] 上传头像: ✅ 通过 / ❌ 失败
- [ ] 数据持久化: ✅ 通过 / ❌ 失败

#### 旅行偏好设置
- [ ] 添加目的地: ✅ 通过 / ❌ 失败
- [ ] 设置旅行风格: ✅ 通过 / ❌ 失败
- [ ] 预算偏好: ✅ 通过 / ❌ 失败
- [ ] 数据持久化: ✅ 通过 / ❌ 失败

#### 修改密码
- [ ] 密码强度检查: ✅ 通过 / ❌ 失败
- [ ] 修改成功: ✅ 通过 / ❌ 失败
- [ ] 新密码登录: ✅ 通过 / ❌ 失败

### 发现的问题
1. [描述问题]
2. [描述问题]

### 建议
1. [改进建议]
2. [改进建议]
```

---

## 下一步

测试通过后:
1. ✅ 配置 Supabase Storage (如未配置)
2. ✅ 完成所有功能测试
3. ✅ 修复发现的 Bug
4. ✅ 提交代码到 Git
5. ✅ 更新 WORK_PLAN.md

---

## 需要帮助?

如遇到问题,请检查:
1. 浏览器控制台 (F12) 的错误信息
2. Network 标签的 API 请求
3. Supabase Dashboard 的 Storage 配置
4. Supabase Dashboard 的 Table Editor (user_profiles)

**参考文档**:
- `docs/SUPABASE_STORAGE_SETUP.md` - Storage 配置
- `docs/DATABASE_DESIGN.md` - 数据库设计
- `frontend/src/services/storage.ts` - Storage 服务代码
