# Task 3.3 地图集成功能测试指南

## 测试目标
验证行程详情页的地图集成功能是否正常工作

## 测试前准备

### 1. 启动前端服务
```bash
cd frontend
npm run dev
```

### 2. 打开浏览器控制台
- Chrome/Edge: F12 或 右键 → 检查
- 查看 Console 标签页

## 测试步骤

### 测试1: 地图加载和定位

**期望结果：**
- ✅ 加载动画出现后自动消失（不应一直显示）
- ✅ 地图自动定位到行程城市（不是北京）
- ✅ 所有行程地点的标记清晰可见
- ✅ 地图视野刚好包含所有标记，有适当边距

**操作步骤：**
1. 登录系统
2. 进入"我的行程"
3. 点击任意行程的"查看详情"
4. 观察右侧地图区域

**控制台日志检查：**
```
📍 开始添加标记，城市: [城市名]，行程天数: [天数]
🔍 尝试地理编码: [地址]
✅ 地理编码成功: [景点名] - [经纬度]
✅ 地图已调整视野，包含 [数量] 个标记
```

**如果看到警告：**
```
⚠️ 所有地址格式都无法编码: [景点名]
```
说明该地点地址有问题，需要在行程数据中修正。

---

### 测试2: 时间线点击 → 地图跳转

**期望结果：**
- ✅ 点击时间线某一项后，地图立即跳转到该地点
- ✅ 地图标记开始跳动（约1.5秒）
- ✅ 标记上方弹出 InfoWindow 显示详情
- ✅ 地图自动缩放到 zoom=16

**操作步骤：**
1. 在详情页左侧时间线中
2. 点击任意一个行程项（如"故宫"）
3. 观察右侧地图变化

---

### 测试3: 地图标记点击 → 时间线高亮

**期望结果：**
- ✅ 点击地图标记后，标记开始跳动
- ✅ 弹出 InfoWindow 显示地点详情
- ✅ 左侧时间线自动滚动到对应项
- ✅ 对应的时间线项背景变为浅蓝色高亮

**操作步骤：**
1. 在详情页右侧地图中
2. 点击任意一个标记
3. 观察左侧时间线和标记动画

---

### 测试4: 路线显示

**期望结果：**
- ✅ 每天的地点之间有彩色线条连接
- ✅ 不同天使用不同颜色（蓝/绿/橙/粉/紫/青）
- ✅ 线条有方向箭头
- ✅ 线条清晰可见（宽度6px）

**操作步骤：**
1. 观察地图上的彩色线条
2. 检查是否按天数分色
3. 放大地图查看箭头方向

---

### 测试5: 标记样式

**期望结果：**
- ✅ 标记大小适中（32x44px）
- ✅ 标记上方显示 "Day X"
- ✅ 不同天的标记颜色不同
- ✅ 鼠标悬停时显示指针
- ✅ 标记层级正确（不被路线遮挡）

**操作步骤：**
1. 观察地图上的标记图标
2. 将鼠标悬停在标记上

---

### 测试6: 地图交互

**期望结果：**
- ✅ 可以拖动地图平移
- ✅ 可以滚轮缩放
- ✅ 可以点击标记
- ✅ 多个 InfoWindow 不会同时显示

**操作步骤：**
1. 拖动地图移动
2. 滚动鼠标滚轮缩放
3. 依次点击多个标记，观察 InfoWindow

---

## 常见问题排查

### 问题1: 加载动画一直显示

**可能原因：**
- 地理编码全部失败
- 地图 API 未正确加载
- 网络问题

**排查步骤：**
1. 检查控制台是否有错误
2. 查看是否有 "❌" 开头的日志
3. 检查 `.env` 文件中高德地图 API Key 是否正确
4. 刷新页面重试

---

### 问题2: 地图仍显示北京

**可能原因：**
- 所有地点地理编码失败
- 城市名称不正确
- 标记没有成功添加

**排查步骤：**
1. 检查控制台 "✅ 地理编码成功" 的数量
2. 如果数量为 0，检查行程数据中的地点名称
3. 尝试手动在高德地图搜索该地点，看是否存在
4. 修正地点名称后重新生成行程

---

### 问题3: 点击时间线无反应

**可能原因：**
- 标记与时间线项映射失败
- 地理编码失败导致标记不存在

**排查步骤：**
1. 检查控制台是否有警告 "未找到 Day X 第 Y 个地点的标记"
2. 确认该地点是否成功地理编码
3. 尝试点击其他时间线项

---

### 问题4: 地图标记点击无反应

**可能原因：**
- 标记事件未正确绑定
- InfoWindow 创建失败

**排查步骤：**
1. 检查控制台是否有 JavaScript 错误
2. 尝试点击其他标记
3. 刷新页面重试

---

## 性能检查

### 加载时间
- 地图初始化: < 2秒
- 标记添加: < 3秒
- 视野调整: < 1秒

### 交互响应
- 点击时间线: 立即响应
- 点击标记: 立即响应
- 地图缩放: 流畅无卡顿

---

## 测试数据要求

为了充分测试功能，建议创建包含以下特征的测试行程：

1. **多天行程**: 至少3天，每天3-5个地点
2. **不同类型**: 景点、餐厅、酒店、交通混合
3. **真实地址**: 使用真实存在的地点名称
4. **不同城市**: 测试北京、上海、西安等不同城市

示例测试数据：
```
城市: 北京
Day 1:
- 故宫 (attraction)
- 全聚德烤鸭店 (restaurant)  
- 王府井大街 (other)

Day 2:
- 长城 (attraction)
- 颐和园 (attraction)
```

---

## 测试完成标准

- [x] 加载动画正常消失
- [x] 地图自动定位到行程城市
- [x] 所有标记正确显示
- [x] 路线清晰可见
- [x] 时间线→地图 联动正常
- [x] 地图→时间线 联动正常
- [x] InfoWindow 正确显示
- [x] 无控制台错误
- [x] 交互流畅

---

## 反馈问题

如果测试中发现问题，请提供以下信息：

1. **问题描述**: 详细说明看到的现象
2. **复现步骤**: 如何触发该问题
3. **控制台日志**: 复制相关的控制台输出
4. **截图**: 如果可能，提供截图
5. **测试数据**: 使用的行程数据（城市、地点名称）

---

## 下一步计划

测试通过后，将继续开发：
- Task 3: 优化地点详情弹窗（POI API）
- Task 5: 添加景点图片展示
- Task 7: 编写完整的测试文档
