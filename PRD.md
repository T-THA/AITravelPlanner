# AI 旅行规划师 - 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品定位
AI 旅行规划师是一款基于人工智能的智能旅行规划 Web 应用，通过语音交互和大语言模型，为用户提供个性化的旅行路线规划、预算管理和实时旅行辅助服务。

### 1.2 目标用户
- 计划出游但缺乏规划经验的用户
- 希望快速生成旅行方案的用户
- 需要预算管理和费用跟踪的用户
- 偏好语音交互的用户

### 1.3 核心价值
- 通过 AI 大幅降低旅行规划的时间成本
- 提供个性化、符合预算的旅行方案
- 语音交互提升用户体验
- 云端同步实现多设备无缝衔接

---

## 2. 功能需求拆解

### 2.1 用户系统模块

#### 2.1.1 注册/登录功能
**优先级**: P0 (最高)

**功能描述**:
- 邮箱/手机号注册
- 邮箱/手机号登录
- 第三方登录（微信/Google/Apple，可选）
- 密码找回功能

**验收标准**:
- [ ] 用户可以成功注册账号
- [ ] 用户可以使用邮箱/手机号登录
- [ ] 密码加密存储
- [ ] 登录状态持久化（7天免登录）
- [ ] 支持密码找回流程

**技术实现**:
- 使用 Supabase Authentication 或 Firebase Auth
- JWT Token 管理用户会话
- 密码使用 bcrypt 加密

#### 2.1.2 用户信息管理
**优先级**: P1

**功能描述**:
- 查看/编辑个人信息（昵称、头像、邮箱）
- 旅行偏好设置（喜好类型、预算范围、出行方式偏好）
- 账号安全设置（修改密码、绑定手机）

**验收标准**:
- [ ] 用户可以修改个人信息
- [ ] 偏好设置可保存并应用到后续规划
- [ ] 修改操作有确认提示

---

### 2.2 语音交互模块

#### 2.2.1 语音输入功能
**优先级**: P0

**功能描述**:
- 实时语音录制
- 语音转文字（ASR）
- 支持中文、英文语音识别
- 显示识别结果并允许修改

**验收标准**:
- [ ] 用户可以点击按钮开始/结束录音
- [ ] 语音实时转为文字显示
- [ ] 识别准确率 > 85%
- [ ] 支持噪音环境下的识别
- [ ] 识别失败有友好提示

**技术实现**:
- 使用科大讯飞 Web API 或浏览器 Web Speech API
- 备选方案：阿里云、腾讯云语音识别
- 前端使用 MediaRecorder API 录音

#### 2.2.2 语音费用记录
**优先级**: P1

**功能描述**:
- 通过语音快速记录开销
- 自动识别金额、类型、时间
- 支持口语化表达（"刚才吃饭花了 150 块"）

**验收标准**:
- [ ] 识别准确提取费用信息
- [ ] 自动分类费用类型
- [ ] 可手动修正识别错误

---

### 2.3 智能行程规划模块

#### 2.3.1 需求输入界面
**优先级**: P0

**功能描述**:
- 支持语音/文字输入旅行需求
- 结构化表单补充细节
  - 目的地（支持多个城市）
  - 出发/返程日期
  - 预算范围
  - 同行人数及构成
  - 旅行偏好（美食/购物/文化/自然/亲子等）
  - 其他特殊需求

**验收标准**:
- [ ] 语音输入可自动填充表单
- [ ] 表单字段有智能提示
- [ ] 必填项校验
- [ ] 支持保存草稿

**UI/UX 要求**:
- 清晰的步骤指引
- 语音输入有动画反馈
- 移动端友好

#### 2.3.2 AI 行程生成
**优先级**: P0

**功能描述**:
- 调用 LLM API 生成行程
- 返回包含以下内容的详细行程：
  - 每日行程安排（时间、地点、活动）
  - 推荐景点（含简介、开放时间、门票）
  - 推荐餐厅（含菜系、人均消费、特色菜）
  - 交通方式建议
  - 住宿推荐（含价格区间、位置）
- 支持重新生成或调整方案

**验收标准**:
- [ ] 生成时间 < 30 秒
- [ ] 行程符合用户需求和预算
- [ ] 行程逻辑合理（路线不绕路、时间安排合理）
- [ ] 包含所有必要信息
- [ ] 支持导出为 PDF/图片

**技术实现**:
- 使用 OpenAI GPT-4 / Claude / 文心一言 / 通义千问
- Prompt Engineering 优化输出结构
- 流式输出提升用户体验
- 结果使用 JSON 格式化存储

#### 2.3.3 行程展示与交互
**优先级**: P0

**功能描述**:
- 时间线形式展示行程
- 地图标注所有地点
- 每个地点可查看详情
- 支持拖拽调整顺序
- 支持添加/删除/修改行程项

**验收标准**:
- [ ] 行程清晰易读
- [ ] 地图与行程联动
- [ ] 点击地点显示详细信息
- [ ] 修改实时保存

**UI/UX 要求**:
- 以地图为中心的交互界面
- 每个景点配有美观图片
- 支持放大查看图片
- 移动端手势操作流畅

---

### 2.4 地图导航模块

#### 2.4.1 地图展示
**优先级**: P0

**功能描述**:
- 显示行程中所有地点
- 不同类型地点用不同图标标注（景点/餐厅/酒店）
- 显示路线连线
- 支持地图缩放、拖动

**验收标准**:
- [ ] 所有地点准确标注
- [ ] 路线清晰可见
- [ ] 地图加载速度 < 3 秒
- [ ] 支持卫星/街景切换

**技术实现**:
- 使用高德地图 Web API 或百度地图 API
- 地点通过 POI 搜索定位

#### 2.4.2 实时导航
**优先级**: P2

**功能描述**:
- 点击地点启动导航
- 显示最优路线
- 估算交通时间和费用

**验收标准**:
- [ ] 导航路线准确
- [ ] 支持多种出行方式（步行/驾车/公交/骑行）
- [ ] 实时交通状况更新

---

### 2.5 费用预算管理模块

#### 2.5.1 AI 预算分析
**优先级**: P0

**功能描述**:
- 根据用户预算和行程，AI 自动分配预算
- 预算分类：交通、住宿、餐饮、门票、购物、其他
- 显示预算占比
- 超预算预警

**验收标准**:
- [ ] 预算分配合理
- [ ] 各项费用清晰展示
- [ ] 可视化图表（饼图/柱状图）
- [ ] 超预算时高亮提示

**技术实现**:
- LLM 生成预算建议
- 前端使用 Chart.js 或 ECharts 可视化

#### 2.5.2 费用记录与跟踪
**优先级**: P1

**功能描述**:
- 手动输入费用
- 语音快速记录费用
- 按类别/日期查看开销
- 实际费用与预算对比
- 支持上传票据照片（可选）

**验收标准**:
- [ ] 费用记录成功保存
- [ ] 统计数据准确
- [ ] 支持导出费用明细（Excel/CSV）
- [ ] 语音记录准确率 > 80%

---

### 2.6 数据存储与同步模块

#### 2.6.1 行程数据管理
**优先级**: P0

**功能描述**:
- 保存多份旅行计划
- 行程列表展示（卡片形式）
- 查看历史行程
- 删除/复制/分享行程

**验收标准**:
- [ ] 数据实时保存到云端
- [ ] 支持离线查看（缓存）
- [ ] 数据加载 < 2 秒

**技术实现**:
- 使用 Supabase 或 Firebase Firestore
- 数据库表设计：
  - users（用户表）
  - trips（行程表）
  - itinerary_items（行程项表）
  - expenses（费用记录表）
  - preferences（用户偏好表）

#### 2.6.2 多设备同步
**优先级**: P1

**功能描述**:
- 数据云端实时同步
- 多设备登录查看/编辑
- 冲突检测与合并

**验收标准**:
- [ ] 数据在不同设备间同步 < 5 秒
- [ ] 编辑冲突有提示
- [ ] 支持离线编辑，上线后同步

---

## 3. 技术架构设计

### 3.1 前端技术栈
**推荐方案**:
- **框架**: React 18 + TypeScript
- **路由**: React Router v6
- **状态管理**: Zustand 或 Redux Toolkit
- **UI 组件**: Ant Design / Material-UI / Tailwind CSS + Headless UI
- **地图**: 高德地图 Web API
- **图表**: ECharts 或 Chart.js
- **语音**: 科大讯飞 Web SDK 或 Web Speech API
- **HTTP 客户端**: Axios
- **打包工具**: Vite

### 3.2 后端技术栈
**推荐方案**:
- **BaaS 平台**: Supabase（推荐）或 Firebase
- **API**: Supabase Functions 或 Node.js + Express
- **数据库**: PostgreSQL（Supabase）或 Firestore
- **认证**: Supabase Auth / Firebase Auth
- **存储**: Supabase Storage（存储用户头像、票据照片）

### 3.3 第三方服务
| 服务类型 | 推荐方案 | 备选方案 |
|---------|---------|---------|
| LLM API | OpenAI GPT-4 Turbo | Claude 3、文心一言、通义千问 |
| 语音识别 | 科大讯飞 | 阿里云、腾讯云、Web Speech API |
| 地图服务 | 高德地图 | 百度地图 |
| 云数据库 | Supabase | Firebase、MongoDB Atlas |

### 3.4 数据库设计（PostgreSQL）

```sql
-- 用户表
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  email VARCHAR(255) UNIQUE NOT NULL,
  username VARCHAR(100),
  avatar_url TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 旅行计划表
CREATE TABLE trips (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  title VARCHAR(255) NOT NULL,
  destination VARCHAR(255),
  start_date DATE,
  end_date DATE,
  budget DECIMAL(10, 2),
  travelers_count INT,
  preferences JSONB,
  status VARCHAR(50) DEFAULT 'draft',
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 行程项表
CREATE TABLE itinerary_items (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  trip_id UUID REFERENCES trips(id) ON DELETE CASCADE,
  day INT,
  time TIME,
  type VARCHAR(50),
  title VARCHAR(255),
  description TEXT,
  location JSONB,
  cost DECIMAL(10, 2),
  order_index INT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- 费用记录表
CREATE TABLE expenses (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  trip_id UUID REFERENCES trips(id) ON DELETE CASCADE,
  category VARCHAR(50),
  amount DECIMAL(10, 2),
  description TEXT,
  date DATE,
  receipt_url TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);
```

---

## 4. 开发计划

### 4.1 阶段划分

#### Phase 1: 基础框架搭建（1 周）
- [ ] 项目初始化（React + TypeScript + Vite）
- [ ] 配置 ESLint、Prettier
- [ ] 搭建基础路由结构
- [ ] 集成 UI 组件库
- [ ] 配置 Supabase/Firebase
- [ ] 实现用户注册/登录功能

#### Phase 2: 核心功能开发（3 周）

**Week 1: 语音交互 + 需求输入**
- [ ] 集成语音识别 SDK
- [ ] 实现语音录制和转文字
- [ ] 开发需求输入表单
- [ ] 语音自动填充表单逻辑

**Week 2: AI 行程生成**
- [ ] 集成 LLM API
- [ ] 设计 Prompt 模板
- [ ] 实现行程生成接口
- [ ] 行程数据结构化处理
- [ ] 行程展示界面（时间线视图）

**Week 3: 地图集成**
- [ ] 集成高德/百度地图
- [ ] 地点标注功能
- [ ] 路线绘制
- [ ] 地图与行程联动

#### Phase 3: 高级功能开发（2 周）

**Week 1: 预算管理**
- [ ] AI 预算分析功能
- [ ] 费用记录界面
- [ ] 语音费用记录
- [ ] 数据可视化图表
- [ ] 预算超支提醒

**Week 2: 数据管理**
- [ ] 行程列表页面
- [ ] 行程详情编辑
- [ ] 数据云端同步
- [ ] 行程分享功能
- [ ] 导出功能（PDF/图片）

#### Phase 4: 优化与测试（1 周）
- [ ] 性能优化（加载速度、渲染优化）
- [ ] 移动端适配
- [ ] 单元测试和集成测试
- [ ] 用户体验测试
- [ ] Bug 修复
- [ ] 文档编写

### 4.2 里程碑
| 里程碑 | 时间节点 | 交付物 |
|--------|---------|--------|
| M1 | 第 1 周末 | 可运行的项目框架 + 登录功能 |
| M2 | 第 3 周末 | 完整的 AI 行程生成流程 |
| M3 | 第 5 周末 | 所有核心功能完成 |
| M4 | 第 7 周末 | 可发布的 MVP 版本 |

---

## 5. 非功能需求

### 5.1 性能要求
- 页面首次加载时间 < 3 秒
- 语音识别响应时间 < 2 秒
- AI 行程生成时间 < 30 秒
- 地图加载时间 < 3 秒
- 支持 1000+ 并发用户

### 5.2 安全要求
- 用户密码加密存储
- HTTPS 加密传输
- API 请求需要身份验证
- 防止 SQL 注入和 XSS 攻击
- 敏感数据不在前端暴露

### 5.3 兼容性要求
- 浏览器：Chrome 90+、Firefox 88+、Safari 14+、Edge 90+
- 设备：桌面端、平板、移动端响应式
- 分辨率：支持 1920x1080、1366x768、375x667 等主流分辨率

### 5.4 可用性要求
- 系统可用性 ≥ 99%
- 数据备份与恢复机制
- 错误日志记录
- 优雅的错误提示

---

## 6. 风险与挑战

### 6.1 技术风险
| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| LLM API 不稳定 | 高 | 设置超时重试、准备备选 API |
| 语音识别准确率低 | 中 | 提供手动修正、多次识别确认 |
| 地图 API 配额限制 | 中 | 合理缓存数据、申请更高配额 |
| 数据库性能瓶颈 | 低 | 建立索引、分页查询、CDN 加速 |

### 6.2 业务风险
- **用户隐私**：严格遵守隐私政策，数据加密存储
- **费用成本**：监控 API 调用量，设置每日上限
- **内容合规**：AI 生成内容需人工审核，避免违规信息

---

## 7. 测试计划

### 7.1 单元测试
- 工具：Jest + React Testing Library
- 覆盖率目标：> 70%
- 重点测试：工具函数、Hooks、状态管理

### 7.2 集成测试
- 测试用户完整流程（注册 → 生成行程 → 记录费用）
- 测试 API 调用和数据同步

### 7.3 端到端测试
- 工具：Playwright 或 Cypress
- 测试关键用户路径

### 7.4 用户验收测试（UAT）
- 邀请 10-20 位用户试用
- 收集反馈并迭代优化

---

## 8. 上线与运维

### 8.1 部署方案
- **前端**: Vercel / Netlify（推荐）
- **后端**: Supabase 托管（Serverless）
- **CDN**: Cloudflare
- **监控**: Sentry（错误监控）+ Google Analytics（用户行为）

### 8.2 发布流程
1. 代码审查（Code Review）
2. 测试环境验证
3. 灰度发布（10% 用户）
4. 监控关键指标
5. 全量发布

### 8.3 运维指标
- 监控系统响应时间
- 监控 API 调用成功率
- 监控错误日志
- 定期数据备份

---

## 9. 后续迭代计划（V2.0）

### 9.1 功能扩展
- [ ] 社交功能（行程分享、好友推荐）
- [ ] 智能推荐（基于历史数据推荐目的地）
- [ ] 多语言支持
- [ ] 行程协作编辑（多人共同规划）
- [ ] 旅行日记（照片、文字记录）
- [ ] AI 旅行顾问（实时问答）

### 9.2 技术优化
- [ ] PWA 支持（离线访问）
- [ ] 微信小程序版本
- [ ] 服务端渲染（SSR）优化 SEO
- [ ] GraphQL 替代 REST API

---

## 10. 附录

### 10.1 参考资料
- [OpenAI API 文档](https://platform.openai.com/docs)
- [科大讯飞语音识别文档](https://www.xfyun.cn/doc/)
- [高德地图 Web API](https://lbs.amap.com/api/javascript-api/summary)
- [Supabase 文档](https://supabase.com/docs)
- [React 官方文档](https://react.dev/)

### 10.2 术语表
- **LLM**: Large Language Model（大语言模型）
- **ASR**: Automatic Speech Recognition（自动语音识别）
- **POI**: Point of Interest（兴趣点）
- **BaaS**: Backend as a Service（后端即服务）
- **PWA**: Progressive Web App（渐进式 Web 应用）

---

**文档版本**: v1.0  
**创建日期**: 2025-01-XX  
**最后更新**: 2025-01-XX  
**负责人**: [项目负责人姓名]
