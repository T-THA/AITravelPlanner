# AI 旅行规划师 - 工作计划文档

## 项目信息

- **项目名称**: AI 旅行规划师 (AITravelPlanner)
- **项目周期**: 7 周
- **开发模式**: 敏捷开发（每周迭代）
- **文档版本**: v1.0
- **最后更新**: 2025-01-XX

---

## 📚 相关文档索引

### 核心文档
- [PRD 产品需求文档](./PRD.md) - 详细功能需求和验收标准
- [数据库设计文档](./docs/DATABASE_DESIGN.md) - 完整的数据库表结构和 SQL
- [技术选型文档](./docs/TECH_STACK.md) - 技术栈选择和决策理由

### 配置指南
- [开发环境搭建指南](./docs/SETUP_GUIDE.md) - 从零开始搭建开发环境
- [Supabase 配置指南](./docs/SUPABASE_SETUP.md) - 数据库和认证配置
- [第三方 API 配置指南](./docs/API_SETUP.md) - 各项第三方服务配置

### 开发规范
- [Git 工作流程文档](./docs/GIT_WORKFLOW.md) - 分支策略和 Commit 规范
- [Prompt 模板文档](./docs/PROMPTS.md) - LLM Prompt 设计和优化

---

## 技术选型确认

| 技术模块 | 选型方案 | 说明 |
|---------|---------|------|
| 用户认证 | 邮箱注册 + Supabase Auth | 仅支持邮箱注册登录 |
| 数据库 | Supabase (PostgreSQL) | 云端数据库 + 实时同步 |
| 语音识别 | 科大讯飞 Web API | 支持中英文语音转文字 |
| 地图服务 | 高德地图 Web API | 地图展示 + POI 搜索 + 路径规划 |
| 大语言模型 | 阿里云百炼平台 | 行程规划 + 预算分析 |
| 前端框架 | React 18 + TypeScript + Vite | 现代化前端技术栈 |
| UI 组件库 | Ant Design | 企业级 UI 组件 |
| 状态管理 | Zustand | 轻量级状态管理 |
| 数据可视化 | ECharts | 费用图表展示 |

📖 **详细说明**: 参见 [技术选型文档](./docs/TECH_STACK.md)

---

## 阶段一：环境搭建与 API 调试（第 1 周）

### 1.1 项目初始化（1 天）

📖 **参考文档**: [开发环境搭建指南](./docs/SETUP_GUIDE.md)

**任务清单**:
- [ ] 创建 React + TypeScript + Vite 项目
- [ ] 配置 ESLint + Prettier
- [ ] 配置 Git 仓库和 .gitignore
- [ ] 安装基础依赖包

**快速命令**:
```bash
npm create vite@latest ai-travel-planner -- --template react-ts
cd ai-travel-planner
npm install
npm install zustand axios react-router-dom antd @supabase/supabase-js echarts dayjs
```

**验收标准**:
- [ ] 项目可正常启动（npm run dev）
- [ ] 代码格式化规则生效
- [ ] Git 提交记录规范

---

### 1.2 Supabase 配置与调试（1 天）

📖 **参考文档**: 
- [Supabase 配置指南](./docs/SUPABASE_SETUP.md)
- [数据库设计文档](./docs/DATABASE_DESIGN.md)

**任务清单**:
- [ ] 注册 Supabase 账号并创建项目
- [ ] 获取 API Keys
- [ ] 运行数据库初始化 SQL 脚本
- [ ] 测试 Supabase Client 连接
- [ ] 实现邮箱注册/登录 API 调用

**SQL 脚本位置**: 参见 [数据库设计文档 - 3.1 节](./docs/DATABASE_DESIGN.md#31-运行-sql-脚本)

**验收标准**:
- [ ] 数据库表创建成功
- [ ] RLS 策略生效
- [ ] 邮箱注册功能正常（收到验证邮件）
- [ ] 登录功能正常（返回 JWT Token）

---

### 1.3 科大讯飞语音识别 API 调试（1 天）

📖 **参考文档**: [第三方 API 配置指南 - 1. 科大讯飞](./docs/API_SETUP.md#1-科大讯飞语音识别-api)

**任务清单**:
- [ ] 注册科大讯飞账号并创建应用
- [ ] 获取 APPID、APISecret、APIKey
- [ ] 实现语音录制功能（MediaRecorder）
- [ ] 实现 WebSocket 连接和音频流传输
- [ ] 测试语音转文字功能

**测试步骤**:
1. 点击录音按钮
2. 说话："我想去北京旅游，5天预算1万元"
3. 停止录音
4. 查看识别结果是否准确

**验收标准**:
- [ ] 成功获取麦克风权限
- [ ] WebSocket 连接成功
- [ ] 语音实时转文字（延迟 < 2 秒）
- [ ] 识别准确率 > 85%（测试 10 条语音）

---

### 1.4 高德地图 API 调试（1 天）

📖 **参考文档**: [第三方 API 配置指南 - 2. 高德地图](./docs/API_SETUP.md#2-高德地图-api)

**任务清单**:
- [ ] 注册高德开放平台账号
- [ ] 创建 Web 端应用并获取 Key
- [ ] 集成高德地图 JS API
- [ ] 测试地图显示功能
- [ ] 测试 POI 搜索功能
- [ ] 测试路径规划功能

**测试场景**:
- [ ] 在北京市搜索"故宫"，显示结果
- [ ] 在地图上标注多个景点
- [ ] 规划从天安门到颐和园的路线

**验收标准**:
- [ ] 地图正常显示
- [ ] POI 搜索返回准确结果
- [ ] 标记正确显示在地图上
- [ ] 路径规划显示完整路线

---

### 1.5 阿里云百炼平台 API 调试（2 天）

📖 **参考文档**: 
- [第三方 API 配置指南 - 3. 阿里云百炼](./docs/API_SETUP.md#3-阿里云百炼平台)
- [Prompt 模板文档](./docs/PROMPTS.md)

**任务清单**:
- [ ] 注册阿里云账号并开通百炼服务
- [ ] 获取 API Key
- [ ] 设计行程规划 Prompt 模板
- [ ] 测试行程生成功能
- [ ] 设计预算分析 Prompt 模板
- [ ] 测试预算分析功能
- [ ] 优化 Prompt 提升输出质量

**Prompt 模板位置**: 参见 [Prompt 模板文档](./docs/PROMPTS.md)

**测试案例**:
```typescript
// 测试用例 1: 北京5日游
const testCase1 = {
  destination: '北京',
  days: 5,
  budget: 10000,
  travelers: 2,
  preferences: ['历史文化', '美食', '摄影']
}
```

**验收标准**:
- [ ] API 调用成功，响应时间 < 30 秒
- [ ] 返回 JSON 格式可正常解析
- [ ] 行程内容完整（包含所有必需字段）
- [ ] 预算分析合理（误差 < 20%）
- [ ] 测试 5 个不同目的地，成功率 100%

---

## 阶段二：用户系统与基础界面（第 2 周）

### 2.1 用户注册/登录模块（2 天）

**任务清单**:
- [ ] 设计登录/注册页面 UI
- [ ] 实现邮箱注册功能
- [ ] 实现邮箱验证流程
- [ ] 实现登录功能
- [ ] 实现密码找回功能
- [ ] JWT Token 管理（存储、刷新、过期处理）
- [ ] 路由守卫（未登录跳转）

**验收标准**:
- [ ] 注册成功后收到验证邮件
- [ ] 邮箱验证后可正常登录
- [ ] 登录后 Token 正确存储
- [ ] 刷新页面保持登录状态
- [ ] 未登录访问保护页面自动跳转

---

### 2.2 路由与布局搭建（1 天）

**任务清单**:
- [ ] 设计整体路由结构
- [ ] 创建主布局组件（Header + Sidebar + Content）
- [ ] 实现导航菜单
- [ ] 实现面包屑导航

**验收标准**:
- [ ] 所有页面路由正常跳转
- [ ] 布局响应式（移动端适配）
- [ ] 导航菜单高亮当前页面

---

### 2.3 个人中心页面（1 天）

**任务清单**:
- [ ] 查看个人信息
- [ ] 编辑昵称和头像
- [ ] 设置旅行偏好
- [ ] 修改密码

**验收标准**:
- [ ] 信息修改成功保存到数据库
- [ ] 头像上传到 Supabase Storage
- [ ] 偏好设置应用到后续行程生成

---

## 阶段三：核心功能开发 - 行程规划（第 3-4 周）

### 3.1 需求输入界面（2 天）

**任务清单**:
- [ ] 设计需求输入表单（步骤式或单页）
- [ ] 集成语音输入组件
- [ ] 实现语音自动填充表单逻辑
- [ ] 表单字段验证
- [ ] 支持保存草稿

**语音解析**: 使用 LLM 解析语音文本并提取结构化数据
📖 **参考**: [Prompt 模板文档 - 3. 语音输入解析](./docs/PROMPTS.md#3-语音输入解析-prompt)

**验收标准**:
- [ ] 表单所有字段正常工作
- [ ] 语音输入可自动填充至少 80% 的字段
- [ ] 必填项校验有友好提示
- [ ] 草稿自动保存

---

### 3.2 AI 行程生成功能（3 天）

📖 **参考文档**: [Prompt 模板文档 - 1. 行程规划](./docs/PROMPTS.md#1-行程规划-prompt)

**任务清单**:
- [ ] 实现行程生成 API 调用
- [ ] 处理流式输出（可选）
- [ ] 解析 JSON 结果并存储到数据库
- [ ] 错误处理（超时、格式错误、API 失败）
- [ ] 添加重新生成功能

**验收标准**:
- [ ] 生成时间 < 30 秒
- [ ] 生成成功率 > 95%
- [ ] 数据正确存储到数据库
- [ ] 错误有重试机制和友好提示

---

### 3.3 行程展示界面（3 天）

**任务清单**:
- [ ] 设计行程详情页布局（左侧地图 + 右侧时间线）
- [ ] 实现时间线组件（按天/按项展示）
- [ ] 集成高德地图并标注所有地点
- [ ] 地点详情弹窗（点击标记显示）
- [ ] 地图与时间线联动
- [ ] 每个景点添加图片

**验收标准**:
- [ ] 地图正确显示所有地点
- [ ] 路线清晰可见
- [ ] 点击标记显示详情
- [ ] 时间线与地图联动
- [ ] 移动端地图可正常操作

---

### 3.4 行程编辑功能（2 天）

**任务清单**:
- [ ] 添加行程项
- [ ] 删除行程项
- [ ] 修改行程项内容
- [ ] 拖拽调整顺序
- [ ] 修改实时保存

**验收标准**:
- [ ] 编辑操作实时保存
- [ ] 拖拽流畅无卡顿
- [ ] 修改后地图同步更新

---

## 阶段四：费用管理与高级功能（第 5 周）

### 4.1 AI 预算分析（2 天）

📖 **参考文档**: [Prompt 模板文档 - 2. 预算分析](./docs/PROMPTS.md#2-预算分析-prompt)

**任务清单**:
- [ ] 调用 LLM 进行预算分析
- [ ] 展示预算分配（饼图/柱状图）
- [ ] 超预算提醒
- [ ] 节省建议展示

**验收标准**:
- [ ] 预算分析合理
- [ ] 图表清晰美观
- [ ] 超预算有明显提示

---

### 4.2 费用记录功能（2 天）

📖 **参考文档**: [Prompt 模板文档 - 4. 费用解析](./docs/PROMPTS.md#4-费用解析-prompt)

**任务清单**:
- [ ] 手动添加费用记录
- [ ] 语音快速记录费用
- [ ] 费用分类（自动/手动）
- [ ] 上传票据照片
- [ ] 费用统计（按类别/按日期）
- [ ] 实际费用与预算对比

**验收标准**:
- [ ] 费用记录成功保存
- [ ] 语音识别准确率 > 80%
- [ ] 统计数据准确
- [ ] 支持导出 Excel

---

### 4.3 行程列表与管理（1 天）

**任务清单**:
- [ ] 行程列表页（卡片展示）
- [ ] 筛选功能（状态/日期）
- [ ] 搜索功能
- [ ] 删除行程（二次确认）
- [ ] 复制行程
- [ ] 行程分享（生成链接）

**验收标准**:
- [ ] 列表加载速度 < 2 秒
- [ ] 分页正常
- [ ] 分享链接可访问

---

## 阶段五：优化与测试（第 6 周）

### 5.1 性能优化（2 天）

**优化项**:
- [ ] 代码分割（React.lazy + Suspense）
- [ ] 图片懒加载
- [ ] 地图组件按需加载
- [ ] API 请求缓存
- [ ] 防抖节流优化
- [ ] 打包体积优化

**测试指标**:
- [ ] 首屏加载时间 < 3 秒
- [ ] Lighthouse 性能分数 > 80

---

### 5.2 测试与 Bug 修复（3 天）

**测试类型**:

**1. 单元测试（简化）**
**2. 集成测试**:
- [ ] 完整流程测试：注册 → 登录 → 创建行程 → 生成行程 → 查看详情 → 记录费用

**3. 浏览器兼容性测试**:
- [ ] Chrome、Firefox、Safari、Edge

**4. 用户场景测试**:
- [ ] 新用户首次使用
- [ ] 语音输入失败处理
- [ ] 网络断开重连

---

## 阶段六：部署上线（第 7 周）

### 6.1 环境配置（1 天）

**任务清单**:
- [ ] 配置生产环境变量
- [ ] 配置 Vercel/Netlify 部署
- [ ] 配置自定义域名（可选）
- [ ] 配置 HTTPS
- [ ] 配置 CDN 加速

---

### 6.2 上线发布（1 天）

**发布步骤**:
1. 代码 Review
2. 最终测试
3. 构建生产版本（npm run build）
4. 部署到 Vercel
5. 烟雾测试
6. 监控错误日志

---

### 6.3 文档编写（1 天）

**文档内容**:
- [ ] 用户使用指南
- [ ] 开发者文档
- [ ] API 文档
- [ ] 部署文档
- [ ] 常见问题 FAQ

---

## 里程碑检查清单

### M1: 基础框架 + API 调试（第 1 周末）
- [ ] 项目可本地运行
- [ ] Supabase 连接成功
- [ ] 科大讯飞语音识别工作正常
- [ ] 高德地图显示正常
- [ ] 阿里云百炼 API 可生成行程

### M2: 用户系统 + 行程规划（第 4 周末）
- [ ] 用户可注册登录
- [ ] 可通过语音输入需求
- [ ] AI 可生成完整行程
- [ ] 行程在地图上正确显示
- [ ] 可编辑行程内容

### M3: 费用管理 + 高级功能（第 5 周末）
- [ ] 预算分析功能正常
- [ ] 可记录费用（手动+语音）
- [ ] 行程列表和管理功能完整
- [ ] 数据云端同步正常

### M4: MVP 版本上线（第 7 周末）
- [ ] 所有核心功能完成
- [ ] 性能达标
- [ ] 移动端适配完成
- [ ] 测试通过
- [ ] 成功部署到生产环境

---

## 风险应对

| 风险 | 应对措施 | 负责人 |
|------|---------|--------|
| API 配额不足 | 申请更高配额，准备备用 API | 开发 |
| 生成时间过长 | 优化 Prompt，使用更快的模型 | 开发 |
| 语音识别不准 | 提供手动修正，增加确认步骤 | 开发 |
| 地图加载慢 | 使用 CDN，缓存地图资源 | 开发 |
| 数据库并发问题 | 增加索引，优化查询 | 开发 |

---

## 附录：快速启动指南

### 本地开发环境搭建

📖 **完整指南**: [开发环境搭建指南](./docs/SETUP_GUIDE.md)

```bash
# 1. 克隆项目
git clone <repository-url>
cd ai-travel-planner

# 2. 安装依赖
npm install

# 3. 配置环境变量
cp .env.example .env
# 编辑 .env 文件，填入各项 API Key

# 4. 启动开发服务器
npm run dev

# 5. 访问 http://localhost:5173
```

### 常用命令

```bash
# 开发
npm run dev

# 构建
npm run build

# 预览构建结果
npm run preview

# 代码检查
npm run lint

# 格式化代码
npm run format
```

---

**文档版本**: v1.0  
**创建时间**: 2025-01-XX  
**最后更新**: 2025-01-XX
